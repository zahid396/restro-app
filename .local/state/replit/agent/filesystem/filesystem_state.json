{"file_contents":{"js/app.js":{"content":"import appState from './state.js';\nimport router from './router.js';\nimport { MenuData, RewardsData, OrderStatusConfig, RestaurantConfig, ReviewsData, loadAllData } from './data.js';\nimport api from './api.js';\n\nclass RestaurantApp {\n    constructor() {\n        this.screens = {};\n        this.orderStatusTimer = null;\n        this.dataLoaded = false;\n        this.init();\n    }\n\n    init() {\n        document.addEventListener('DOMContentLoaded', async () => {\n            this.cacheScreens();\n            this.bindGlobalEvents();\n            this.setupRouter();\n            this.updateCartBadge();\n            this.updateTableNumber();\n            this.updateLanguageToggle();\n            this.updateBottomNav('menu');\n            \n            try {\n                await loadAllData();\n                this.dataLoaded = true;\n                this.renderMenu();\n                this.updateRestaurantName();\n            } catch (error) {\n                console.error('Failed to load data:', error);\n                this.showToast('Failed to load menu data');\n            }\n        });\n\n        appState.subscribe(() => {\n            this.updateCartBadge();\n            this.updateTableNumber();\n            this.updateRestaurantName();\n        });\n    }\n\n    cacheScreens() {\n        this.screens = {\n            menu: document.getElementById('screen-menu'),\n            detail: document.getElementById('screen-detail'),\n            cart: document.getElementById('screen-cart'),\n            status: document.getElementById('screen-status'),\n            feedback: document.getElementById('screen-feedback'),\n            game: document.getElementById('screen-game')\n        };\n    }\n\n    setupRouter() {\n        router.subscribe((screen) => {\n            this.showScreen(screen);\n            this.syncBottomNavWithScreen(screen);\n        });\n    }\n\n    syncBottomNavWithScreen(screen) {\n        const screenToNav = {\n            'menu': 'menu',\n            'detail': 'menu',\n            'cart': 'checkout',\n            'status': 'orders',\n            'feedback': 'orders',\n            'game': 'menu'\n        };\n        const navTarget = screenToNav[screen] || 'menu';\n        this.updateBottomNav(navTarget);\n    }\n\n    showScreen(screenName) {\n        Object.values(this.screens).forEach(screen => {\n            if (screen) screen.classList.add('hidden');\n        });\n        if (this.screens[screenName]) {\n            this.screens[screenName].classList.remove('hidden');\n            window.scrollTo(0, 0);\n        }\n        \n        const bottomNav = document.getElementById('bottom-nav');\n        if (bottomNav) {\n            if (screenName === 'detail') {\n                bottomNav.classList.add('hidden');\n            } else {\n                bottomNav.classList.remove('hidden');\n            }\n        }\n    }\n\n    bindGlobalEvents() {\n        document.querySelectorAll('[data-lang-toggle]').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const lang = e.currentTarget.dataset.lang;\n                appState.setLanguage(lang);\n                this.updateLanguageToggle();\n                this.renderMenu();\n                this.renderActiveScreen();\n            });\n        });\n\n        document.querySelectorAll('[data-nav-back]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                if (router.canGoBack()) {\n                    router.back();\n                } else {\n                    router.navigate('menu');\n                }\n            });\n        });\n\n        document.querySelectorAll('[data-nav-cart]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                this.renderCart();\n                router.navigate('cart');\n            });\n        });\n\n        document.querySelectorAll('[data-mood-filter]').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const mood = e.currentTarget.dataset.moodFilter;\n                appState.setMoodFilter(mood);\n                this.updateMoodFilters();\n                this.renderMenuItems();\n            });\n        });\n\n        document.querySelectorAll('[data-category-filter]').forEach(link => {\n            link.addEventListener('click', (e) => {\n                e.preventDefault();\n                const category = e.currentTarget.dataset.categoryFilter;\n                appState.setFilter(category);\n                this.updateCategoryNav();\n                this.scrollToCategory(category);\n            });\n        });\n\n        const viewOrderBtn = document.getElementById('view-order-btn');\n        if (viewOrderBtn) {\n            viewOrderBtn.addEventListener('click', () => {\n                this.renderCart();\n                router.navigate('cart');\n            });\n        }\n\n        const payNowBtn = document.getElementById('pay-now-btn');\n        if (payNowBtn) {\n            payNowBtn.addEventListener('click', () => {\n                this.handlePayment();\n            });\n        }\n\n        const addToOrderDetailBtn = document.getElementById('add-to-order-detail');\n        if (addToOrderDetailBtn) {\n            addToOrderDetailBtn.addEventListener('click', () => {\n                this.handleAddFromDetail();\n            });\n        }\n\n        document.querySelectorAll('[data-bill-split]').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const mode = e.currentTarget.dataset.billSplit;\n                this.setBillSplitMode(mode);\n            });\n        });\n\n        document.querySelectorAll('[data-payment-method]').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const method = e.currentTarget.dataset.paymentMethod;\n                this.setPaymentMethod(method);\n            });\n        });\n\n        const gameClaimBtn = document.getElementById('game-claim-btn');\n        if (gameClaimBtn) {\n            gameClaimBtn.addEventListener('click', () => {\n                router.navigate('menu');\n            });\n        }\n\n        const feedbackSubmitBtn = document.getElementById('feedback-submit-btn');\n        if (feedbackSubmitBtn) {\n            feedbackSubmitBtn.addEventListener('click', () => {\n                this.submitFeedback();\n            });\n        }\n\n        document.querySelectorAll('[data-game-card]').forEach(card => {\n            card.addEventListener('click', (e) => {\n                this.revealReward(e.currentTarget);\n            });\n        });\n\n        document.querySelectorAll('[data-star-rating]').forEach(star => {\n            star.addEventListener('click', (e) => {\n                const rating = parseInt(e.currentTarget.dataset.starRating);\n                this.setRating(rating);\n            });\n        });\n\n        document.querySelectorAll('[data-feedback-tag]').forEach(tag => {\n            tag.addEventListener('click', (e) => {\n                this.toggleFeedbackTag(e.currentTarget);\n            });\n        });\n\n        const reorderBtn = document.getElementById('reorder-btn');\n        if (reorderBtn) {\n            reorderBtn.addEventListener('click', () => {\n                this.handleReorder();\n            });\n        }\n\n        const addMoreBtn = document.getElementById('add-more-btn');\n        if (addMoreBtn) {\n            addMoreBtn.addEventListener('click', () => {\n                router.navigate('menu');\n            });\n        }\n\n        document.querySelectorAll('[data-nav-game]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                this.showGameModal();\n            });\n        });\n\n        document.querySelectorAll('[data-bottom-nav]').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const target = e.currentTarget.dataset.bottomNav;\n                this.handleBottomNav(target);\n            });\n        });\n\n        const thankyouCloseBtn = document.getElementById('thankyou-close-btn');\n        if (thankyouCloseBtn) {\n            thankyouCloseBtn.addEventListener('click', () => {\n                this.closeThankYouPopup();\n            });\n        }\n\n        this.splitCount = 2;\n        this.setupSplitBillControls();\n    }\n\n    handleBottomNav(target) {\n        this.updateBottomNav(target);\n        switch(target) {\n            case 'menu':\n                router.navigate('menu');\n                break;\n            case 'orders':\n                if (appState.get('cart').length > 0 || appState.get('orderHistory')?.length > 0) {\n                    router.navigate('status');\n                    this.renderOrderStatus();\n                } else {\n                    this.showToast('No active orders yet');\n                }\n                break;\n            case 'checkout':\n                this.renderCart();\n                router.navigate('cart');\n                break;\n        }\n    }\n\n    updateBottomNav(active) {\n        document.querySelectorAll('[data-bottom-nav]').forEach(btn => {\n            const target = btn.dataset.bottomNav;\n            const icon = btn.querySelector('.material-symbols-outlined');\n            const label = btn.querySelector('span:last-child');\n            \n            if (target === active) {\n                btn.classList.remove('text-gray-400');\n                btn.classList.add('text-primary');\n                if (icon) icon.style.fontVariationSettings = \"'FILL' 1\";\n                if (label) {\n                    label.classList.remove('font-medium');\n                    label.classList.add('font-bold');\n                }\n            } else {\n                btn.classList.add('text-gray-400');\n                btn.classList.remove('text-primary');\n                if (icon) icon.style.fontVariationSettings = \"'FILL' 0\";\n                if (label) {\n                    label.classList.add('font-medium');\n                    label.classList.remove('font-bold');\n                }\n            }\n        });\n    }\n\n    updateRestaurantName() {\n        const lang = appState.get('language');\n        const name = RestaurantConfig.name[lang] || RestaurantConfig.name.en;\n        document.querySelectorAll('[data-restaurant-name]').forEach(el => {\n            el.textContent = name;\n        });\n    }\n\n    renderActiveScreen() {\n        const current = router.getCurrent();\n        switch(current) {\n            case 'menu': this.renderMenu(); break;\n            case 'cart': this.renderCart(); break;\n            case 'detail': this.renderDetail(appState.get('ui').selectedItemId); break;\n            case 'status': this.renderOrderStatus(); break;\n            case 'feedback': this.renderFeedback(); break;\n        }\n    }\n\n    updateLanguageToggle() {\n        const lang = appState.get('language');\n        document.querySelectorAll('[data-lang-toggle]').forEach(btn => {\n            const btnLang = btn.dataset.lang;\n            if (btnLang === lang) {\n                btn.classList.add('bg-white', 'dark:bg-card-dark', 'shadow-sm');\n                btn.classList.remove('text-text-muted');\n            } else {\n                btn.classList.remove('bg-white', 'dark:bg-card-dark', 'shadow-sm');\n                btn.classList.add('text-text-muted');\n            }\n        });\n    }\n\n    updateTableNumber() {\n        const tableId = appState.get('tableId');\n        document.querySelectorAll('[data-table-number]').forEach(el => {\n            el.textContent = `Table ${tableId}`;\n        });\n        document.querySelectorAll('[data-table-badge]').forEach(el => {\n            el.textContent = `Table #${tableId}`;\n        });\n    }\n\n    updateCartBadge() {\n        const count = appState.getCartItemCount();\n        const total = appState.getCartTotal();\n        const lang = appState.get('language');\n\n        document.querySelectorAll('[data-cart-count]').forEach(el => {\n            el.textContent = count;\n        });\n        document.querySelectorAll('[data-cart-total]').forEach(el => {\n            el.textContent = `BDT ${total.toLocaleString()}`;\n        });\n        document.querySelectorAll('[data-cart-items-text]').forEach(el => {\n            el.textContent = lang === 'bn' ? `${count}টি আইটেম যোগ করা হয়েছে` : `${count} Items added`;\n        });\n\n        const cartBar = document.getElementById('view-order-btn');\n        if (cartBar) {\n            cartBar.style.display = count > 0 ? 'flex' : 'none';\n        }\n    }\n\n    renderMenu() {\n        const lang = appState.get('language');\n        const items = MenuData.items;\n        const trendingItems = items.filter(i => i.trending);\n\n        const trendingContainer = document.getElementById('trending-items');\n        if (trendingContainer) {\n            trendingContainer.innerHTML = trendingItems.map(item => this.renderTrendingCard(item, lang)).join('');\n            this.bindQuickAddButtons(trendingContainer);\n            this.bindCardClicks(trendingContainer);\n        }\n\n        this.renderMenuItems();\n    }\n\n    renderMenuItems() {\n        const lang = appState.get('language');\n        const activeMood = appState.get('activeMood');\n        let items = MenuData.items;\n\n        if (activeMood) {\n            items = items.filter(i => i.mood && i.mood.includes(activeMood));\n        }\n\n        const categories = MenuData.categories;\n        \n        categories.forEach(cat => {\n            const container = document.getElementById(`items-${cat.id}`);\n            if (container) {\n                const catItems = items.filter(i => i.category === cat.id);\n                container.innerHTML = catItems.map(item => this.renderMenuCard(item, lang)).join('');\n                this.bindQuickAddButtons(container);\n                this.bindCardClicks(container);\n            }\n        });\n    }\n\n    renderTrendingCard(item, lang) {\n        const name = item.name[lang] || item.name.en;\n        return `\n        <div class=\"flex flex-col w-[200px] sm:w-[240px] md:w-[280px] bg-white dark:bg-card-dark rounded-2xl shadow-md overflow-hidden relative group cursor-pointer shrink-0\" data-item-id=\"${item.id}\">\n            <div class=\"w-full aspect-square bg-gray-200 dark:bg-gray-800 bg-center bg-cover relative\" style='background-image: url(\"${item.image}\");'>\n                <button class=\"absolute bottom-3 right-3 bg-white dark:bg-card-dark rounded-full p-2 shadow-lg z-10 text-gray-300 dark:text-gray-600 hover:text-red-500 transition-colors\" data-favorite=\"${item.id}\">\n                    <span class=\"material-symbols-outlined text-[20px]\">favorite</span>\n                </button>\n            </div>\n            <div class=\"p-3 sm:p-4 flex flex-col gap-1\">\n                <h3 class=\"text-base sm:text-lg font-bold text-gray-900 dark:text-white leading-tight line-clamp-2\">${name}</h3>\n                <div class=\"flex items-center gap-4 sm:gap-6 mt-2\">\n                    <div class=\"flex items-center gap-1.5\">\n                        <span class=\"material-symbols-outlined text-orange-500 text-[16px] sm:text-[18px]\">thumb_up</span>\n                        <span class=\"text-xs sm:text-sm font-semibold text-text-muted\">${this.formatNumber(item.likes)}</span>\n                    </div>\n                    <div class=\"flex items-center gap-1.5\">\n                        <span class=\"material-symbols-outlined text-blue-400 text-[16px] sm:text-[18px]\">chat_bubble</span>\n                        <span class=\"text-xs sm:text-sm font-semibold text-text-muted\">${item.comments}</span>\n                    </div>\n                </div>\n            </div>\n        </div>`;\n    }\n\n    renderMenuCard(item, lang) {\n        const name = item.name[lang] || item.name.en;\n        const tags = item.tags || [];\n        \n        return `\n        <div class=\"@container\">\n            <div class=\"flex flex-col items-stretch justify-start rounded-xl bg-white dark:bg-card-dark shadow-md dark:shadow-none overflow-hidden transition-transform active:scale-[0.98] cursor-pointer\" data-item-id=\"${item.id}\">\n                <div class=\"relative w-full aspect-square bg-gray-200 dark:bg-gray-800 bg-center bg-cover\" style='background-image: url(\"${item.image}\");'>\n                    ${tags.length > 0 ? `<div class=\"absolute top-1 left-1\"><span class=\"px-1.5 py-0.5 bg-black/60 backdrop-blur-md rounded text-white text-[8px] font-bold uppercase\">${tags[0]}</span></div>` : ''}\n                </div>\n                <div class=\"flex w-full flex-col p-2 gap-1\">\n                    <h4 class=\"text-xs font-bold leading-tight dark:text-white text-gray-900 line-clamp-2\">${name}</h4>\n                    <div class=\"flex items-center justify-between\">\n                        <p class=\"text-xs font-bold text-primary\">৳${item.price}</p>\n                        <button class=\"flex h-6 w-6 shrink-0 cursor-pointer items-center justify-center rounded-full bg-primary text-background-dark shadow-sm active:bg-primary/90\" data-quick-add=\"${item.id}\">\n                            <span class=\"material-symbols-outlined text-[14px]\">add</span>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>`;\n    }\n\n    bindQuickAddButtons(container) {\n        container.querySelectorAll('[data-quick-add]').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                e.stopPropagation();\n                const itemId = parseInt(btn.dataset.quickAdd);\n                const item = MenuData.items.find(i => i.id === itemId);\n                if (item) {\n                    appState.addToCart(item, 1);\n                    this.showToast(`${item.name[appState.get('language')]} added to cart!`);\n                    this.checkComboSuggestion(item);\n                }\n            });\n        });\n    }\n\n    bindCardClicks(container) {\n        container.querySelectorAll('[data-item-id]').forEach(card => {\n            card.addEventListener('click', (e) => {\n                if (e.target.closest('[data-quick-add]') || e.target.closest('[data-favorite]')) return;\n                const itemId = parseInt(card.dataset.itemId);\n                appState.setSelectedItem(itemId);\n                this.renderDetail(itemId);\n                router.navigate('detail');\n            });\n        });\n    }\n\n    renderDetail(itemId) {\n        const item = MenuData.items.find(i => i.id === itemId);\n        if (!item) return;\n\n        const lang = appState.get('language');\n        const name = item.name[lang] || item.name.en;\n        const desc = item.description[lang] || item.description.en;\n\n        document.getElementById('detail-name').textContent = name;\n        document.getElementById('detail-price').textContent = `৳ ${item.price.toLocaleString()}`;\n        document.getElementById('detail-weight').textContent = item.weight;\n        document.getElementById('detail-rating').textContent = item.rating;\n        document.getElementById('detail-description').textContent = desc;\n        document.getElementById('detail-image').style.backgroundImage = `url(\"${item.image}\")`;\n\n        const tagsContainer = document.getElementById('detail-tags');\n        if (tagsContainer) {\n            const tags = item.tags || [];\n            tagsContainer.innerHTML = tags.map(tag => `\n                <div class=\"flex items-center gap-2 px-4 py-2.5 rounded-full bg-slate-200 dark:bg-white/5 border border-transparent dark:border-white/10 shrink-0\">\n                    <span class=\"text-sm font-bold text-slate-800 dark:text-white capitalize\">${tag}</span>\n                </div>\n            `).join('');\n        }\n\n        if (item.allergens) {\n            document.getElementById('detail-allergens').textContent = item.allergens;\n            document.getElementById('allergen-section').classList.remove('hidden');\n        } else {\n            document.getElementById('allergen-section').classList.add('hidden');\n        }\n\n        this.renderReviews(itemId, item.comments);\n\n        this.detailQuantity = 1;\n        this.updateDetailTotal(item);\n    }\n\n    renderReviews(itemId, totalComments) {\n        const reviewsContainer = document.getElementById('reviews-container');\n        const reviewsCount = document.getElementById('reviews-count');\n        \n        if (!reviewsContainer) return;\n\n        const itemReviews = ReviewsData.reviews.filter(r => r.itemId === itemId);\n        \n        reviewsCount.textContent = `${totalComments} reviews`;\n\n        if (itemReviews.length === 0) {\n            reviewsContainer.innerHTML = `\n                <div class=\"text-center py-6 text-gray-400\">\n                    <span class=\"material-symbols-outlined text-3xl mb-2\">rate_review</span>\n                    <p class=\"text-sm\">No reviews yet. Be the first to review!</p>\n                </div>\n            `;\n            return;\n        }\n\n        reviewsContainer.innerHTML = itemReviews.map(review => `\n            <div class=\"bg-slate-100 dark:bg-white/5 rounded-xl p-4 border border-slate-200 dark:border-white/5\">\n                <div class=\"flex items-start gap-3\">\n                    <div class=\"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-xl shrink-0\">\n                        ${review.avatar}\n                    </div>\n                    <div class=\"flex-1 min-w-0\">\n                        <div class=\"flex items-center justify-between gap-2 mb-1\">\n                            <span class=\"font-bold text-sm text-slate-900 dark:text-white\">${review.user}</span>\n                            <span class=\"text-xs text-gray-400\">${review.date}</span>\n                        </div>\n                        <div class=\"flex items-center gap-0.5 mb-2\">\n                            ${Array.from({length: 5}, (_, i) => `\n                                <span class=\"material-symbols-outlined text-[14px] ${i < review.rating ? 'text-yellow-400' : 'text-gray-300 dark:text-gray-600'}\" style=\"font-variation-settings: 'FILL' 1;\">star</span>\n                            `).join('')}\n                        </div>\n                        <p class=\"text-sm text-slate-600 dark:text-gray-300 leading-relaxed\">${review.comment}</p>\n                    </div>\n                </div>\n            </div>\n        `).join('');\n    }\n\n    updateDetailTotal(item) {\n        const total = item.price * this.detailQuantity;\n        document.getElementById('detail-quantity').textContent = this.detailQuantity;\n        document.getElementById('detail-total').textContent = `৳ ${total.toLocaleString()}`;\n    }\n\n    handleAddFromDetail() {\n        const itemId = appState.get('ui').selectedItemId;\n        const item = MenuData.items.find(i => i.id === itemId);\n        if (item) {\n            appState.addToCart(item, this.detailQuantity || 1);\n            this.showToast(`${item.name[appState.get('language')]} added to cart!`);\n            this.checkComboSuggestion(item);\n            router.navigate('menu');\n        }\n    }\n\n    checkComboSuggestion(item) {\n        const combo = MenuData.combos.find(c => c.triggerItemId === item.id);\n        if (combo) {\n            this.showComboSuggestion(combo);\n        }\n    }\n\n    showComboSuggestion(combo) {\n        const lang = appState.get('language');\n        const modal = document.getElementById('combo-modal');\n        const message = combo.message[lang] || combo.message.en;\n        \n        document.getElementById('combo-message').textContent = message;\n        \n        const itemsContainer = document.getElementById('combo-items');\n        const items = combo.suggestItemIds.map(id => MenuData.items.find(i => i.id === id)).filter(Boolean);\n        \n        itemsContainer.innerHTML = items.map(item => `\n            <div class=\"flex items-center gap-3 p-3 bg-white/5 rounded-xl\">\n                <div class=\"w-16 h-16 rounded-xl bg-cover bg-center\" style=\"background-image: url('${item.image}')\"></div>\n                <div class=\"flex-1\">\n                    <p class=\"font-bold text-sm\">${item.name[lang]}</p>\n                    <p class=\"text-primary text-sm font-bold\">৳ ${item.price}</p>\n                </div>\n                <button class=\"h-8 w-8 rounded-full bg-primary text-black flex items-center justify-center\" data-combo-add=\"${item.id}\">\n                    <span class=\"material-symbols-outlined text-[18px]\">add</span>\n                </button>\n            </div>\n        `).join('');\n\n        modal.classList.remove('hidden');\n\n        itemsContainer.querySelectorAll('[data-combo-add]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                const id = parseInt(btn.dataset.comboAdd);\n                const item = MenuData.items.find(i => i.id === id);\n                if (item) {\n                    appState.addToCart(item, 1);\n                    this.showToast(`${item.name[lang]} added!`);\n                }\n            });\n        });\n\n        document.getElementById('combo-close').addEventListener('click', () => {\n            modal.classList.add('hidden');\n        });\n\n        document.getElementById('combo-dismiss').addEventListener('click', () => {\n            modal.classList.add('hidden');\n        });\n    }\n\n    renderCart() {\n        const cart = appState.get('cart');\n        const lang = appState.get('language');\n        const container = document.getElementById('cart-items');\n        \n        if (!container) return;\n\n        if (cart.length === 0) {\n            container.innerHTML = `\n                <div class=\"text-center py-12\">\n                    <span class=\"material-symbols-outlined text-6xl text-gray-400 mb-4\">shopping_cart</span>\n                    <p class=\"text-gray-500\">${lang === 'bn' ? 'আপনার কার্ট খালি' : 'Your cart is empty'}</p>\n                </div>\n            `;\n            this.updateCartTotals();\n            return;\n        }\n\n        container.innerHTML = cart.map((ci, index) => `\n            <div class=\"flex gap-4 p-3 bg-white dark:bg-white/5 rounded-2xl shadow-sm border border-black/5 dark:border-white/5\">\n                <div class=\"bg-center bg-no-repeat bg-cover rounded-xl size-[80px] shrink-0\" style='background-image: url(\"${ci.item.image}\");'></div>\n                <div class=\"flex flex-1 flex-col justify-between py-1\">\n                    <div>\n                        <div class=\"flex justify-between items-start\">\n                            <h3 class=\"text-black dark:text-white text-base font-bold leading-tight\">${ci.item.name[lang]}</h3>\n                            <span class=\"text-black dark:text-white font-bold\">৳ ${(ci.item.price * ci.quantity).toLocaleString()}</span>\n                        </div>\n                        ${ci.customizations ? `<p class=\"text-gray-500 dark:text-gray-400 text-xs mt-1\">${ci.customizations}</p>` : ''}\n                    </div>\n                    <div class=\"flex justify-end\">\n                        <div class=\"flex items-center gap-3 bg-black/5 dark:bg-black/20 rounded-full p-1\">\n                            <button class=\"size-7 flex items-center justify-center rounded-full bg-white dark:bg-white/10 text-black dark:text-white shadow-sm\" data-cart-minus=\"${index}\">\n                                <span class=\"material-symbols-outlined text-[16px]\">remove</span>\n                            </button>\n                            <span class=\"text-sm font-bold text-black dark:text-white w-2 text-center\">${ci.quantity}</span>\n                            <button class=\"size-7 flex items-center justify-center rounded-full bg-primary text-black shadow-sm\" data-cart-plus=\"${index}\">\n                                <span class=\"material-symbols-outlined text-[16px]\">add</span>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `).join('');\n\n        container.querySelectorAll('[data-cart-minus]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                const index = parseInt(btn.dataset.cartMinus);\n                const current = appState.get('cart')[index];\n                appState.updateCartQuantity(index, current.quantity - 1);\n                this.renderCart();\n            });\n        });\n\n        container.querySelectorAll('[data-cart-plus]').forEach(btn => {\n            btn.addEventListener('click', () => {\n                const index = parseInt(btn.dataset.cartPlus);\n                const current = appState.get('cart')[index];\n                appState.updateCartQuantity(index, current.quantity + 1);\n                this.renderCart();\n            });\n        });\n\n        this.updateCartTotals();\n    }\n\n    updateCartTotals() {\n        const subtotal = appState.getCartTotal();\n        const vat = Math.round(subtotal * 0.05);\n        const service = Math.round(subtotal * 0.05);\n        const total = subtotal + vat + service;\n\n        document.getElementById('cart-subtotal').textContent = `৳ ${subtotal.toLocaleString()}`;\n        document.getElementById('cart-vat').textContent = `৳ ${vat.toLocaleString()}`;\n        document.getElementById('cart-service').textContent = `৳ ${service.toLocaleString()}`;\n        document.getElementById('cart-total').textContent = `৳ ${total.toLocaleString()}`;\n        document.getElementById('cart-pay-total').textContent = `৳ ${total.toLocaleString()}`;\n    }\n\n    setBillSplitMode(mode) {\n        this.billSplitMode = mode;\n        document.querySelectorAll('[data-bill-split]').forEach(btn => {\n            if (btn.dataset.billSplit === mode) {\n                btn.classList.add('bg-white', 'dark:bg-white/10', 'shadow-sm');\n                btn.classList.remove('text-gray-500');\n            } else {\n                btn.classList.remove('bg-white', 'dark:bg-white/10', 'shadow-sm');\n                btn.classList.add('text-gray-500');\n            }\n        });\n\n        const splitSection = document.getElementById('split-bill-section');\n        if (splitSection) {\n            if (mode === 'split') {\n                splitSection.classList.remove('hidden');\n                this.splitCount = this.splitCount || 2;\n                this.updateSplitBillUI();\n            } else {\n                splitSection.classList.add('hidden');\n            }\n        }\n    }\n\n    setupSplitBillControls() {\n        const minusBtn = document.getElementById('split-minus');\n        const plusBtn = document.getElementById('split-plus');\n\n        if (minusBtn) {\n            minusBtn.addEventListener('click', () => {\n                if (this.splitCount > 2) {\n                    this.splitCount--;\n                    this.updateSplitBillUI();\n                }\n            });\n        }\n\n        if (plusBtn) {\n            plusBtn.addEventListener('click', () => {\n                if (this.splitCount < 20) {\n                    this.splitCount++;\n                    this.updateSplitBillUI();\n                }\n            });\n        }\n    }\n\n    updateSplitBillUI() {\n        const countEl = document.getElementById('split-count');\n        const perPersonEl = document.getElementById('per-person-amount');\n\n        if (countEl) {\n            countEl.textContent = this.splitCount;\n        }\n\n        if (perPersonEl) {\n            const subtotal = appState.getCartTotal();\n            const vat = Math.round(subtotal * 0.05);\n            const service = Math.round(subtotal * 0.05);\n            const total = subtotal + vat + service;\n            const perPerson = Math.ceil(total / this.splitCount);\n            perPersonEl.textContent = `৳ ${perPerson.toLocaleString()}`;\n        }\n    }\n\n    setPaymentMethod(method) {\n        this.selectedPaymentMethod = method;\n        document.querySelectorAll('[data-payment-method]').forEach(btn => {\n            const btnMethod = btn.dataset.paymentMethod;\n            if (btnMethod === method) {\n                btn.classList.add('border-2', 'border-primary', 'bg-primary/10');\n                btn.classList.remove('border-black/10', 'dark:border-white/10');\n                const checkmark = btn.querySelector('.checkmark');\n                if (!checkmark) {\n                    btn.insertAdjacentHTML('beforeend', `\n                        <div class=\"absolute -top-1.5 -right-1.5 size-4 rounded-full bg-primary flex items-center justify-center shadow-md checkmark\">\n                            <span class=\"material-symbols-outlined text-black text-[10px] font-bold\">check</span>\n                        </div>\n                    `);\n                }\n            } else {\n                btn.classList.remove('border-2', 'border-primary', 'bg-primary/10');\n                btn.classList.add('border-black/10', 'dark:border-white/10');\n                const checkmark = btn.querySelector('.checkmark');\n                if (checkmark) checkmark.remove();\n            }\n        });\n    }\n\n    async handlePayment() {\n        const method = this.selectedPaymentMethod || 'cash';\n        const cart = appState.get('cart');\n        const tableId = appState.get('tableId');\n        \n        if (cart.length === 0) {\n            this.showToast('No items in cart');\n            return;\n        }\n        \n        try {\n            const orderResponse = await api.createOrder(tableId, cart, method);\n            \n            appState.set('order', {\n                id: orderResponse.order_id,\n                status: orderResponse.status,\n                items: cart,\n                total: orderResponse.total,\n                paymentMethod: method,\n                createdAt: orderResponse.created_at\n            });\n            \n            if (method === 'cash') {\n                this.showThankYouPopup();\n            } else {\n                await this.simulateDigitalPayment();\n                this.showThankYouPopup();\n            }\n        } catch (error) {\n            console.error('Failed to create order:', error);\n            this.showToast('Failed to place order');\n        }\n    }\n\n    showThankYouPopup() {\n        const modal = document.getElementById('thankyou-modal');\n        if (modal) {\n            modal.classList.remove('hidden');\n        }\n    }\n\n    closeThankYouPopup() {\n        const modal = document.getElementById('thankyou-modal');\n        if (modal) {\n            modal.classList.add('hidden');\n        }\n        appState.clearCart();\n        this.renderOrderStatus();\n        router.navigate('status');\n        this.startOrderStatusSimulation();\n    }\n\n    simulateDigitalPayment() {\n        return new Promise(resolve => {\n            this.showToast('Processing payment...');\n            setTimeout(() => {\n                this.showToast('Payment successful!');\n                resolve();\n            }, 2000);\n        });\n    }\n\n    renderOrderStatus() {\n        const order = appState.get('order');\n        if (!order) return;\n\n        const lang = appState.get('language');\n        const statusConfig = OrderStatusConfig.statuses;\n        const currentIndex = statusConfig.findIndex(s => s.id === order.status);\n\n        const timeline = document.getElementById('status-timeline');\n        if (timeline) {\n            timeline.innerHTML = statusConfig.map((status, index) => {\n                const isComplete = index < currentIndex;\n                const isCurrent = index === currentIndex;\n                const isPending = index > currentIndex;\n\n                return `\n                <div class=\"flex flex-col items-center h-full\">\n                    <div class=\"relative flex items-center justify-center w-8 h-8 z-10 ${isCurrent ? '' : ''}\">\n                        ${isCurrent ? '<div class=\"absolute inset-0 bg-primary rounded-full animate-ping opacity-75\"></div>' : ''}\n                        <div class=\"relative w-8 h-8 rounded-full ${isComplete || isCurrent ? 'bg-primary text-black' : 'bg-gray-200 dark:bg-white/10 text-gray-400'} flex items-center justify-center\">\n                            <span class=\"material-symbols-outlined\" style=\"font-size: 20px;\">${isComplete ? 'check' : status.icon}</span>\n                        </div>\n                    </div>\n                    ${index < statusConfig.length - 1 ? `<div class=\"w-[2px] ${isComplete ? 'bg-primary' : 'bg-gray-200 dark:bg-white/10'} h-full min-h-[40px]\"></div>` : ''}\n                </div>\n                <div class=\"flex flex-col pb-8 pt-1 pl-4 ${isPending ? 'opacity-40' : ''}\">\n                    <p class=\"text-base font-bold leading-none ${isCurrent ? 'text-primary text-lg' : ''}\">${status.label[lang]}</p>\n                    <p class=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">${status.chefMessage ? status.chefMessage[lang] : (status.message ? status.message[lang] : '')}</p>\n                </div>\n                `;\n            }).join('');\n        }\n\n        const eta = document.getElementById('status-eta');\n        if (eta) {\n            const remaining = Math.max(0, OrderStatusConfig.etaMinutes - currentIndex * 3);\n            eta.innerHTML = `~${remaining}<span class=\"text-2xl ml-1 text-gray-400 dark:text-gray-500 font-bold\">mins</span>`;\n        }\n\n        const statusTitle = document.getElementById('status-title');\n        const statusSubtitle = document.getElementById('status-subtitle');\n        if (statusTitle && statusSubtitle) {\n            const titles = {\n                received: { en: 'Order Received!', bn: 'অর্ডার গৃহীত!' },\n                cooking: { en: 'Fire in the kitchen!', bn: 'রান্নাঘরে আগুন!' },\n                plating: { en: 'Almost there!', bn: 'প্রায় হয়ে গেছে!' },\n                delivered: { en: 'Enjoy your meal!', bn: 'আপনার খাবার উপভোগ করুন!' }\n            };\n            const subtitles = {\n                received: { en: 'We got your order.', bn: 'আমরা আপনার অর্ডার পেয়েছি।' },\n                cooking: { en: 'We are preparing your order.', bn: 'আমরা আপনার অর্ডার প্রস্তুত করছি।' },\n                plating: { en: 'Final touches being added.', bn: 'চূড়ান্ত স্পর্শ যোগ করা হচ্ছে।' },\n                delivered: { en: 'Your food has been served.', bn: 'আপনার খাবার পরিবেশন করা হয়েছে।' }\n            };\n            statusTitle.textContent = titles[order.status][lang];\n            statusSubtitle.textContent = subtitles[order.status][lang];\n        }\n\n        const orderItemsContainer = document.getElementById('status-order-items');\n        if (orderItemsContainer && order.items) {\n            orderItemsContainer.innerHTML = order.items.map(ci => `\n                <div class=\"flex gap-4 items-center\">\n                    <div class=\"w-16 h-16 rounded-xl bg-cover bg-center shrink-0\" style=\"background-image: url('${ci.item.image}');\"></div>\n                    <div class=\"flex-1\">\n                        <div class=\"flex justify-between items-start\">\n                            <p class=\"font-bold text-sm\">${ci.item.name[lang]}</p>\n                            <p class=\"text-sm font-bold opacity-70\">x${ci.quantity}</p>\n                        </div>\n                        ${ci.customizations ? `<p class=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">${ci.customizations}</p>` : ''}\n                    </div>\n                </div>\n            `).join('<div class=\"w-full h-[1px] bg-gray-100 dark:bg-white/5\"></div>');\n        }\n    }\n\n    startOrderStatusSimulation() {\n        const statuses = ['received', 'cooking', 'plating', 'delivered'];\n        let currentIndex = 0;\n        \n        if (this.orderStatusTimer) clearInterval(this.orderStatusTimer);\n\n        this.orderStatusTimer = setInterval(() => {\n            currentIndex++;\n            if (currentIndex >= statuses.length) {\n                clearInterval(this.orderStatusTimer);\n                this.onOrderDelivered();\n                return;\n            }\n            appState.updateOrderStatus(statuses[currentIndex]);\n            this.renderOrderStatus();\n        }, 5000);\n    }\n\n    onOrderDelivered() {\n        setTimeout(() => {\n            this.showGameModal();\n        }, 2000);\n    }\n\n    showGameModal() {\n        router.navigate('game');\n        this.gameRevealed = false;\n    }\n\n    async revealReward(cardElement) {\n        if (this.gameRevealed) return;\n        this.gameRevealed = true;\n\n        const lang = appState.get('language');\n\n        document.querySelectorAll('[data-game-card]').forEach(card => {\n            card.classList.add('opacity-50', 'pointer-events-none');\n        });\n        cardElement.classList.remove('opacity-50');\n        cardElement.classList.add('ring-2', 'ring-primary');\n\n        try {\n            const reward = await api.getReward();\n            \n            const rewardSection = document.getElementById('reward-reveal');\n            rewardSection.classList.remove('hidden');\n            \n            document.getElementById('reward-name').textContent = reward.name[lang] || reward.name.en;\n            document.getElementById('reward-description').textContent = reward.description[lang] || reward.description.en;\n            \n            if (reward.image) {\n                document.getElementById('reward-image').style.backgroundImage = `url('${reward.image}')`;\n            }\n            \n            document.getElementById('reward-timer').textContent = `Valid for this order only. Expires in ${reward.expires_in || 15}:00`;\n        } catch (error) {\n            console.error('Failed to get reward:', error);\n            this.showToast('Failed to get reward');\n        }\n    }\n\n    renderFeedback() {\n        const lang = appState.get('language');\n        const feedback = appState.get('feedback');\n\n        document.querySelectorAll('[data-star-rating]').forEach((star, index) => {\n            const icon = star.querySelector('.material-symbols-outlined');\n            if (index < feedback.rating) {\n                icon.classList.add('filled', 'text-primary');\n                icon.classList.remove('text-gray-300', 'dark:text-gray-600');\n            } else {\n                icon.classList.remove('filled', 'text-primary');\n                icon.classList.add('text-gray-300', 'dark:text-gray-600');\n            }\n        });\n\n        const ratingText = document.getElementById('rating-text');\n        if (ratingText) {\n            const texts = {\n                1: { en: 'Poor', bn: 'খারাপ' },\n                2: { en: 'Fair', bn: 'মোটামুটি' },\n                3: { en: 'Good', bn: 'ভালো' },\n                4: { en: 'Very Good', bn: 'খুব ভালো' },\n                5: { en: 'Excellent', bn: 'অসাধারণ' }\n            };\n            ratingText.textContent = texts[feedback.rating] ? texts[feedback.rating][lang] : '';\n        }\n    }\n\n    setRating(rating) {\n        const feedback = appState.get('feedback');\n        feedback.rating = rating;\n        appState.set('feedback', feedback);\n        this.renderFeedback();\n    }\n\n    toggleFeedbackTag(tagElement) {\n        const tag = tagElement.dataset.feedbackTag;\n        const feedback = appState.get('feedback');\n        const index = feedback.tags.indexOf(tag);\n        \n        if (index >= 0) {\n            feedback.tags.splice(index, 1);\n            tagElement.classList.remove('bg-primary', 'shadow-lg', 'shadow-primary/20');\n            tagElement.classList.add('bg-white', 'dark:bg-surface-dark', 'border-gray-200');\n            const checkIcon = tagElement.querySelector('.check-icon');\n            if (checkIcon) checkIcon.remove();\n        } else {\n            feedback.tags.push(tag);\n            tagElement.classList.add('bg-primary', 'shadow-lg', 'shadow-primary/20');\n            tagElement.classList.remove('bg-white', 'dark:bg-surface-dark', 'border-gray-200');\n            if (!tagElement.querySelector('.check-icon')) {\n                tagElement.insertAdjacentHTML('beforeend', '<span class=\"material-symbols-outlined text-black text-lg font-bold check-icon\">check</span>');\n            }\n        }\n        \n        appState.set('feedback', feedback);\n    }\n\n    async submitFeedback() {\n        const feedback = appState.get('feedback');\n        feedback.comment = document.getElementById('feedback-comment')?.value || '';\n        const order = appState.get('order');\n        \n        try {\n            if (order?.id) {\n                await api.submitReview(order.id, null, feedback.rating, feedback.comment);\n            }\n            localStorage.setItem('lastFeedback', JSON.stringify(feedback));\n            this.showToast('Thank you for your feedback!');\n            router.navigate('menu');\n        } catch (error) {\n            console.error('Failed to submit feedback:', error);\n            localStorage.setItem('lastFeedback', JSON.stringify(feedback));\n            this.showToast('Thank you for your feedback!');\n            router.navigate('menu');\n        }\n    }\n\n    handleReorder() {\n        const lastOrder = appState.getLastOrder();\n        if (!lastOrder || !lastOrder.items) {\n            this.showToast('No previous order found');\n            return;\n        }\n\n        lastOrder.items.forEach(ci => {\n            const currentItem = MenuData.items.find(i => i.id === ci.item.id);\n            if (currentItem) {\n                appState.addToCart(currentItem, ci.quantity, ci.customizations);\n            }\n        });\n\n        this.showToast('Previous order added to cart!');\n        this.renderCart();\n        router.navigate('cart');\n    }\n\n    updateMoodFilters() {\n        const activeMood = appState.get('activeMood');\n        document.querySelectorAll('[data-mood-filter]').forEach(btn => {\n            const mood = btn.dataset.moodFilter;\n            if (mood === activeMood) {\n                btn.classList.add('bg-primary', 'text-background-dark', 'shadow-lg', 'shadow-primary/20');\n                btn.classList.remove('bg-white', 'dark:bg-[#2d372a]', 'border-gray-200');\n            } else {\n                btn.classList.remove('bg-primary', 'text-background-dark', 'shadow-lg', 'shadow-primary/20');\n                btn.classList.add('bg-white', 'dark:bg-[#2d372a]', 'border-gray-200');\n            }\n        });\n    }\n\n    updateCategoryNav() {\n        const activeFilter = appState.get('activeFilter');\n        document.querySelectorAll('[data-category-filter]').forEach(link => {\n            const cat = link.dataset.categoryFilter;\n            if (cat === activeFilter) {\n                link.classList.add('border-b-primary', 'text-black', 'dark:text-white');\n                link.classList.remove('border-b-transparent', 'text-text-muted');\n            } else {\n                link.classList.remove('border-b-primary', 'text-black', 'dark:text-white');\n                link.classList.add('border-b-transparent', 'text-text-muted');\n            }\n        });\n    }\n\n    scrollToCategory(category) {\n        const section = document.getElementById(`section-${category}`);\n        if (section) {\n            section.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        }\n    }\n\n    formatNumber(num) {\n        if (num >= 1000) {\n            return (num / 1000).toFixed(1) + 'k';\n        }\n        return num.toString();\n    }\n\n    showToast(message) {\n        const existing = document.querySelector('.toast-notification');\n        if (existing) existing.remove();\n\n        const toast = document.createElement('div');\n        toast.className = 'toast-notification fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-black/90 text-white px-6 py-3 rounded-full text-sm font-medium z-[100] animate-fade-in';\n        toast.textContent = message;\n        document.body.appendChild(toast);\n\n        setTimeout(() => {\n            toast.classList.add('animate-fade-out');\n            setTimeout(() => toast.remove(), 300);\n        }, 2500);\n    }\n}\n\nwindow.detailQuantityMinus = function() {\n    const app = window.restaurantApp;\n    if (app.detailQuantity > 1) {\n        app.detailQuantity--;\n        const itemId = appState.get('ui').selectedItemId;\n        const item = MenuData.items.find(i => i.id === itemId);\n        app.updateDetailTotal(item);\n    }\n};\n\nwindow.detailQuantityPlus = function() {\n    const app = window.restaurantApp;\n    app.detailQuantity++;\n    const itemId = appState.get('ui').selectedItemId;\n    const item = MenuData.items.find(i => i.id === itemId);\n    app.updateDetailTotal(item);\n};\n\nconst app = new RestaurantApp();\nwindow.restaurantApp = app;\n\nexport default app;\n","path":null,"size_bytes":48378,"size_tokens":null},"js/router.js":{"content":"class Router {\n    constructor() {\n        this.history = [];\n        this.currentScreen = 'menu';\n        this.listeners = [];\n    }\n\n    subscribe(listener) {\n        this.listeners.push(listener);\n        return () => {\n            this.listeners = this.listeners.filter(l => l !== listener);\n        };\n    }\n\n    notify() {\n        this.listeners.forEach(listener => listener(this.currentScreen, this.history));\n    }\n\n    navigate(screen, data = null) {\n        if (this.currentScreen !== screen) {\n            this.history.push({ screen: this.currentScreen, data });\n        }\n        this.currentScreen = screen;\n        this.notify();\n        return screen;\n    }\n\n    back() {\n        if (this.history.length > 0) {\n            const prev = this.history.pop();\n            this.currentScreen = prev.screen;\n            this.notify();\n            return prev;\n        }\n        return null;\n    }\n\n    canGoBack() {\n        return this.history.length > 0;\n    }\n\n    getCurrent() {\n        return this.currentScreen;\n    }\n\n    reset() {\n        this.history = [];\n        this.currentScreen = 'menu';\n        this.notify();\n    }\n}\n\nconst router = new Router();\nexport default router;\n","path":null,"size_bytes":1195,"size_tokens":null},"js/state.js":{"content":"class AppState {\n    constructor() {\n        this.state = {\n            tableId: 12,\n            language: 'en',\n            menu: [],\n            cart: [],\n            order: null,\n            activeFilter: null,\n            activeMood: null,\n            ui: {\n                currentScreen: 'menu',\n                selectedItemId: null,\n                showComboSuggestion: false,\n                comboItems: []\n            },\n            feedback: {\n                rating: 0,\n                tags: [],\n                comment: ''\n            }\n        };\n        this.listeners = [];\n        this.init();\n    }\n\n    init() {\n        const urlParams = new URLSearchParams(window.location.search);\n        const tableParam = urlParams.get('table');\n        if (tableParam) {\n            this.state.tableId = parseInt(tableParam) || 12;\n        }\n\n        const pathMatch = window.location.pathname.match(/\\/t\\/(\\d+)/);\n        if (pathMatch) {\n            this.state.tableId = parseInt(pathMatch[1]) || 12;\n        }\n\n        const savedLang = localStorage.getItem('preferredLanguage');\n        if (savedLang) {\n            this.state.language = savedLang;\n        }\n\n        const savedCart = sessionStorage.getItem('cart');\n        if (savedCart) {\n            try {\n                this.state.cart = JSON.parse(savedCart);\n            } catch (e) {\n                this.state.cart = [];\n            }\n        }\n\n        const savedOrder = sessionStorage.getItem('currentOrder');\n        if (savedOrder) {\n            try {\n                this.state.order = JSON.parse(savedOrder);\n            } catch (e) {\n                this.state.order = null;\n            }\n        }\n    }\n\n    subscribe(listener) {\n        this.listeners.push(listener);\n        return () => {\n            this.listeners = this.listeners.filter(l => l !== listener);\n        };\n    }\n\n    notify() {\n        this.listeners.forEach(listener => listener(this.state));\n    }\n\n    get(key) {\n        return key ? this.state[key] : this.state;\n    }\n\n    set(key, value) {\n        this.state[key] = value;\n        this.persist();\n        this.notify();\n    }\n\n    update(updates) {\n        Object.assign(this.state, updates);\n        this.persist();\n        this.notify();\n    }\n\n    persist() {\n        sessionStorage.setItem('cart', JSON.stringify(this.state.cart));\n        if (this.state.order) {\n            sessionStorage.setItem('currentOrder', JSON.stringify(this.state.order));\n        }\n        localStorage.setItem('preferredLanguage', this.state.language);\n    }\n\n    setLanguage(lang) {\n        this.state.language = lang;\n        localStorage.setItem('preferredLanguage', lang);\n        this.notify();\n    }\n\n    addToCart(item, quantity = 1, customizations = '') {\n        const existingIndex = this.state.cart.findIndex(\n            ci => ci.item.id === item.id && ci.customizations === customizations\n        );\n\n        if (existingIndex >= 0) {\n            this.state.cart[existingIndex].quantity += quantity;\n        } else {\n            this.state.cart.push({ item, quantity, customizations });\n        }\n        this.persist();\n        this.notify();\n        return this.state.cart;\n    }\n\n    removeFromCart(index) {\n        this.state.cart.splice(index, 1);\n        this.persist();\n        this.notify();\n    }\n\n    updateCartQuantity(index, quantity) {\n        if (quantity <= 0) {\n            this.removeFromCart(index);\n        } else {\n            this.state.cart[index].quantity = quantity;\n            this.persist();\n            this.notify();\n        }\n    }\n\n    clearCart() {\n        this.state.cart = [];\n        this.persist();\n        this.notify();\n    }\n\n    getCartTotal() {\n        return this.state.cart.reduce((total, ci) => total + (ci.item.price * ci.quantity), 0);\n    }\n\n    getCartItemCount() {\n        return this.state.cart.reduce((count, ci) => count + ci.quantity, 0);\n    }\n\n    createOrder(paymentMethod) {\n        const order = {\n            id: 'ORD-' + Date.now(),\n            tableId: this.state.tableId,\n            items: [...this.state.cart],\n            paymentMethod,\n            status: 'received',\n            createdAt: new Date().toISOString(),\n            total: this.getCartTotal()\n        };\n        this.state.order = order;\n        localStorage.setItem('lastOrder', JSON.stringify(order));\n        this.persist();\n        this.notify();\n        return order;\n    }\n\n    updateOrderStatus(status) {\n        if (this.state.order) {\n            this.state.order.status = status;\n            this.persist();\n            this.notify();\n        }\n    }\n\n    getLastOrder() {\n        const saved = localStorage.getItem('lastOrder');\n        return saved ? JSON.parse(saved) : null;\n    }\n\n    setFilter(category) {\n        this.state.activeFilter = category;\n        this.notify();\n    }\n\n    setMoodFilter(mood) {\n        this.state.activeMood = this.state.activeMood === mood ? null : mood;\n        this.notify();\n    }\n\n    setScreen(screen) {\n        this.state.ui.currentScreen = screen;\n        this.notify();\n    }\n\n    setSelectedItem(itemId) {\n        this.state.ui.selectedItemId = itemId;\n        this.notify();\n    }\n}\n\nconst appState = new AppState();\nexport default appState;\n","path":null,"size_bytes":5229,"size_tokens":null},"server.py":{"content":"import http.server\nimport socketserver\n\nPORT = 5000\n\nclass NoCacheHandler(http.server.SimpleHTTPRequestHandler):\n    def end_headers(self):\n        self.send_header('Cache-Control', 'no-cache, no-store, must-revalidate')\n        self.send_header('Pragma', 'no-cache')\n        self.send_header('Expires', '0')\n        super().end_headers()\n\nwith socketserver.TCPServer((\"0.0.0.0\", PORT), NoCacheHandler) as httpd:\n    print(f\"Serving at http://0.0.0.0:{PORT}\")\n    httpd.serve_forever()\n","path":null,"size_bytes":486,"size_tokens":null},"replit.md":{"content":"# Restaurant Ordering App\n\n## Overview\nAn interactive restaurant ordering app built with vanilla HTML/CSS/JS frontend and PHP + PostgreSQL backend. All menu data, orders, and reviews are now powered by a real database and REST API.\n\n## Project Structure\n```\n/\n├── index.html          # Single-page app with all screens\n├── router.php          # PHP router for API and static files\n├── api/\n│   ├── index.php       # API router with endpoint definitions\n│   ├── includes/\n│   │   ├── config.php  # Database configuration\n│   │   ├── db.php      # PDO database connection\n│   │   └── utils.php   # Helper functions (CORS, JSON, etc.)\n│   ├── menu/\n│   │   ├── categories.php  # GET /api/menu/categories\n│   │   ├── items.php       # GET /api/menu/items\n│   │   └── item.php        # GET /api/menu/item/{id}\n│   ├── order/\n│   │   ├── create.php      # POST /api/order/create\n│   │   ├── get.php         # GET /api/order/{id}\n│   │   ├── status.php      # POST /api/order/status\n│   │   └── split.php       # POST /api/order/split\n│   ├── restaurant/\n│   │   ├── config.php      # GET /api/restaurant/config\n│   │   └── table.php       # GET /api/table/{id}\n│   ├── review/\n│   │   └── submit.php      # POST /api/review/submit\n│   └── game/\n│       └── reward.php      # GET /api/game/reward\n├── js/\n│   ├── app.js          # Main app logic & event bindings\n│   ├── api.js          # API service layer for backend calls\n│   ├── data.js         # Data loader (fetches from API)\n│   ├── state.js        # State management (cart, orders, language)\n│   └── router.js       # Screen navigation & history\n└── attached_assets/    # Original static screens (reference)\n```\n\n## Database Schema (PostgreSQL)\n- `restaurants` - Restaurant configuration and branding\n- `restaurant_tables` - Table management\n- `categories` - Menu categories with EN/BN names\n- `menu_items` - Full menu with prices, images, tags, mood filters\n- `orders` - Order tracking with status lifecycle\n- `order_items` - Items in each order\n- `bill_splits` - Bill splitting records\n- `reviews` - Customer feedback and ratings\n- `games_rewards` - Probability-based rewards for mini-game\n\n## API Endpoints\n### Restaurant & Table\n- `GET /api/restaurant/config` - Get restaurant name and branding\n- `GET /api/table/{tableNumber}` - Get table info\n\n### Menu\n- `GET /api/menu/categories?lang=en|bn` - Get all categories\n- `GET /api/menu/items?lang=en|bn` - Get all menu items\n- `GET /api/menu/item/{id}?lang=en|bn` - Get single item details\n\n### Orders\n- `POST /api/order/create` - Create new order\n- `GET /api/order/{orderId}` - Get order details\n- `POST /api/order/status` - Update order status\n- `POST /api/order/split` - Split bill among members\n\n### Rewards & Reviews\n- `GET /api/game/reward` - Get random reward based on probability\n- `POST /api/review/submit` - Submit feedback\n\n## Features\n- Dynamic menu with categories (Starters, Burgers, Mains, Drinks, Desserts)\n- Mood-based filters (Spicy, Comfort, Healthy, Sweet)\n- EN/BN language toggle\n- Add to cart with combo suggestions\n- Bill splitting with member count input and per-person calculation\n- Payment methods (bKash, Nagad, Cash, etc.)\n- Thank you popup when proceeding with payment showing waiter ETA\n- Live order status with animated timeline\n- Mini-game rewards system (probability-based from database)\n- Feedback/rating screen with API submission\n- Bottom navigation with Menu, Orders, and Bills tabs\n- Restaurant name branding from database\n- Responsive grid layout for menu items\n\n## Recent Changes (Dec 16, 2025)\n- **Backend Integration Complete**:\n  - Added PHP 8 + PostgreSQL backend\n  - Created REST API for all frontend data\n  - Frontend now fetches from `/api/` endpoints\n  - Orders stored in database with full lifecycle tracking\n  - Rewards system uses probability-based selection from database\n  - Reviews submitted to database via API\n\n## Running the App\n```bash\nphp -S 0.0.0.0:5000 router.php\n```\nServes on http://0.0.0.0:5000\n\n## URL Parameters\n- `?table=N` - Set table number (default: 12)\n- `/t/N` - Alternative table number path\n\n## Tech Stack\n- Frontend: Vanilla JavaScript (ES6 modules), Tailwind CSS (CDN), Material Symbols\n- Backend: PHP 8.4, PostgreSQL\n- No frameworks - plain PHP for backend per requirement\n","path":null,"size_bytes":4516,"size_tokens":null},"js/data.js":{"content":"import api from './api.js';\n\nlet RestaurantConfig = {\n    name: { en: 'Loading...', bn: 'লোড হচ্ছে...' },\n    tagline: { en: '', bn: '' }\n};\n\nlet MenuData = {\n    categories: [],\n    items: [],\n    combos: [],\n    moodFilters: [\n        { id: 'spicy', label: { en: 'Spicy 🌶️', bn: 'ঝাল 🌶️' }, icon: 'whatshot' },\n        { id: 'comfort', label: { en: 'Comfort 🍜', bn: 'আরাম 🍜' }, icon: 'soup_kitchen' },\n        { id: 'healthy', label: { en: 'Healthy 🥗', bn: 'স্বাস্থ্যকর 🥗' }, icon: 'eco' },\n        { id: 'sweet', label: { en: 'Sweet 🍰', bn: 'মিষ্টি 🍰' }, icon: 'cake' }\n    ]\n};\n\nconst ReviewsData = {\n    reviews: []\n};\n\nconst RewardsData = {\n    rewards: []\n};\n\nconst OrderStatusConfig = {\n    statuses: [\n        { id: 'received', label: { en: 'Order Received', bn: 'অর্ডার নেওয়া হয়েছে' }, icon: 'check', duration: 3000 },\n        { id: 'cooking', label: { en: 'Cooking', bn: 'রান্না হচ্ছে' }, icon: 'skillet', duration: 8000, chefMessage: { en: 'Chef is on it!', bn: 'Chef is on it!' } },\n        { id: 'ready', label: { en: 'Ready', bn: 'প্রস্তুত' }, icon: 'room_service', duration: null, message: { en: 'Almost ready', bn: 'প্রায় প্রস্তুত' }, requiresAdminConfirm: true },\n        { id: 'delivered', label: { en: 'Served', bn: 'পরিবেশন করা হয়েছে' }, icon: 'dinner_dining', duration: 0, message: { en: 'Enjoy your meal', bn: 'আপনার খাবার উপভোগ করুন' } }\n    ],\n    etaMinutes: 12\n};\n\nlet currentStatusIndex = 0;\n\nfunction getCurrentStatus() {\n    return OrderStatusConfig.statuses[currentStatusIndex];\n}\n\nfunction advanceToNextStatus() {\n    if (currentStatusIndex < OrderStatusConfig.statuses.length - 1) {\n        const nextStatusIndex = currentStatusIndex + 1;\n        const nextStatus = OrderStatusConfig.statuses[nextStatusIndex];\n\n        if (nextStatus.requiresAdminConfirm) {\n            return false;\n        }\n\n        currentStatusIndex = nextStatusIndex;\n        return true;\n    }\n    return false;\n}\n\nfunction adminConfirmDelivered() {\n    currentStatusIndex = OrderStatusConfig.statuses.length - 1;\n}\n\nfunction resetOrderStatus() {\n    currentStatusIndex = 0;\n}\n\nfunction getOrderStatusConfig() {\n    return OrderStatusConfig;\n}\n\nasync function loadRestaurantConfig() {\n    try {\n        const config = await api.getRestaurantConfig();\n        RestaurantConfig.name = config.name;\n        RestaurantConfig.tagline = config.tagline;\n        return RestaurantConfig;\n    } catch (error) {\n        console.error('Failed to load restaurant config:', error);\n        return RestaurantConfig;\n    }\n}\n\nasync function loadMenuData() {\n    try {\n        const [categories, items] = await Promise.all([\n            api.getCategories(),\n            api.getMenuItems()\n        ]);\n        \n        MenuData.categories = categories;\n        MenuData.items = items;\n        \n        MenuData.combos = generateCombos(items);\n        \n        return MenuData;\n    } catch (error) {\n        console.error('Failed to load menu data:', error);\n        return MenuData;\n    }\n}\n\nfunction generateCombos(items) {\n    const combos = [];\n    const burgers = items.filter(i => i.category === 'burgers');\n    const starters = items.filter(i => i.category === 'starters');\n    const drinks = items.filter(i => i.category === 'drinks');\n    \n    burgers.forEach(burger => {\n        const starterItem = starters[0];\n        const drinkItem = drinks[0];\n        if (starterItem && drinkItem) {\n            combos.push({\n                triggerItemId: burger.id,\n                suggestItemIds: [starterItem.id, drinkItem.id],\n                message: { en: 'Perfect pair! Add fries & drink?', bn: 'পারফেক্ট জোড়া! ফ্রাইস এবং ড্রিংক যোগ করুন?' }\n            });\n        }\n    });\n    \n    return combos;\n}\n\nasync function loadAllData() {\n    await Promise.all([\n        loadRestaurantConfig(),\n        loadMenuData()\n    ]);\n}\n\nexport { \n    MenuData, \n    RewardsData, \n    OrderStatusConfig, \n    RestaurantConfig, \n    ReviewsData,\n    loadRestaurantConfig,\n    loadMenuData,\n    loadAllData\n};\n","path":null,"size_bytes":4324,"size_tokens":null},"api/menu/item.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$itemId = (int)($_GET['id'] ?? 0);\n\nif ($itemId <= 0) {\n    jsonResponse(['error' => 'Invalid item ID'], 400);\n}\n\n$db = getDB();\n$stmt = $db->prepare(\"SELECT * FROM menu_items WHERE id = ?\");\n$stmt->execute([$itemId]);\n$item = $stmt->fetch();\n\nif (!$item) {\n    jsonResponse(['error' => 'Item not found'], 404);\n}\n\n$reviewStmt = $db->prepare(\"SELECT * FROM reviews WHERE menu_item_id = ? ORDER BY created_at DESC LIMIT 10\");\n$reviewStmt->execute([$itemId]);\n$reviews = $reviewStmt->fetchAll();\n\n$comboStmt = $db->prepare(\"SELECT * FROM combos WHERE trigger_item_id = ?\");\n$comboStmt->execute([$itemId]);\n$combo = $comboStmt->fetch();\n\n$reviewList = [];\nforeach ($reviews as $r) {\n    $reviewList[] = [\n        'id' => $r['id'],\n        'user' => $r['user_name'],\n        'avatar' => $r['avatar'],\n        'rating' => (int)$r['rating'],\n        'comment' => $r['comment'],\n        'date' => $r['created_at']\n    ];\n}\n\n$response = [\n    'id' => $item['id'],\n    'name' => [\n        'en' => $item['name_en'],\n        'bn' => $item['name_bn']\n    ],\n    'description' => [\n        'en' => $item['description_en'],\n        'bn' => $item['description_bn']\n    ],\n    'price' => (int)$item['price'],\n    'category' => $item['category_id'],\n    'image' => $item['image_url'],\n    'weight' => $item['weight'],\n    'rating' => (float)$item['rating'],\n    'likes' => (int)$item['likes'],\n    'comments' => (int)$item['comments_count'],\n    'tags' => json_decode($item['tags'] ?? '[]', true),\n    'mood' => json_decode($item['mood'] ?? '[]', true),\n    'taste' => json_decode($item['taste'] ?? '[]', true),\n    'trending' => (bool)$item['is_trending'],\n    'allergens' => $item['allergens'],\n    'reviews' => $reviewList\n];\n\nif ($combo) {\n    $response['combo'] = [\n        'suggestItemIds' => json_decode($combo['suggested_item_ids'], true),\n        'message' => [\n            'en' => $combo['message_en'],\n            'bn' => $combo['message_bn']\n        ],\n        'discount' => (int)$combo['discount_amount']\n    ];\n}\n\njsonResponse($response);\n","path":null,"size_bytes":2146,"size_tokens":null},"api/game/reward.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$restaurantId = getRestaurantId();\n\n$db = getDB();\n$stmt = $db->prepare(\"SELECT * FROM games_rewards WHERE restaurant_id = ? ORDER BY probability DESC\");\n$stmt->execute([$restaurantId]);\n$rewards = $stmt->fetchAll();\n\nif (empty($rewards)) {\n    jsonResponse(['error' => 'No rewards available'], 404);\n}\n\n$rand = mt_rand(0, 100) / 100;\n$cumulative = 0;\n$selectedReward = $rewards[0];\n\nforeach ($rewards as $reward) {\n    $cumulative += (float)$reward['probability'];\n    if ($rand <= $cumulative) {\n        $selectedReward = $reward;\n        break;\n    }\n}\n\njsonResponse([\n    'id' => $selectedReward['id'],\n    'name' => [\n        'en' => $selectedReward['name_en'],\n        'bn' => $selectedReward['name_bn']\n    ],\n    'description' => [\n        'en' => $selectedReward['description_en'],\n        'bn' => $selectedReward['description_bn']\n    ],\n    'image' => $selectedReward['image_url'],\n    'reward_type' => $selectedReward['reward_type'],\n    'reward_value' => (int)$selectedReward['reward_value'],\n    'expires_in' => (int)$selectedReward['expires_in']\n]);\n","path":null,"size_bytes":1175,"size_tokens":null},"api/review/submit.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$input = getInput();\n\n$orderId = isset($input['order_id']) ? (int)$input['order_id'] : null;\n$menuItemId = (int)($input['menu_item_id'] ?? 0);\n$rating = (int)($input['rating'] ?? 0);\n$comment = sanitize($input['comment'] ?? '');\n$userName = sanitize($input['user_name'] ?? 'Anonymous');\n$avatar = sanitize($input['avatar'] ?? '👤');\n\nif ($rating < 1 || $rating > 5) {\n    jsonResponse(['error' => 'Rating must be between 1 and 5'], 400);\n}\n\n$db = getDB();\n\n$stmt = $db->prepare(\"\n    INSERT INTO reviews (order_id, menu_item_id, user_name, avatar, rating, comment) \n    VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at\n\");\n$stmt->execute([$orderId, $menuItemId ?: null, $userName, $avatar, $rating, $comment]);\n$review = $stmt->fetch();\n\nif ($menuItemId > 0) {\n    $updateStmt = $db->prepare(\"UPDATE menu_items SET comments_count = comments_count + 1 WHERE id = ?\");\n    $updateStmt->execute([$menuItemId]);\n}\n\njsonResponse([\n    'success' => true,\n    'review_id' => $review['id'],\n    'created_at' => $review['created_at']\n]);\n","path":null,"size_bytes":1143,"size_tokens":null},"api/restaurant/table.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$tableNumber = (int)($_GET['id'] ?? 0);\n$restaurantId = getRestaurantId();\n\nif ($tableNumber <= 0) {\n    jsonResponse(['error' => 'Invalid table number'], 400);\n}\n\n$db = getDB();\n$stmt = $db->prepare(\"SELECT * FROM restaurant_tables WHERE table_number = ? AND restaurant_id = ?\");\n$stmt->execute([$tableNumber, $restaurantId]);\n$table = $stmt->fetch();\n\nif (!$table) {\n    $stmt = $db->prepare(\"INSERT INTO restaurant_tables (restaurant_id, table_number, status) VALUES (?, ?, 'free') RETURNING *\");\n    $stmt->execute([$restaurantId, $tableNumber]);\n    $table = $stmt->fetch();\n}\n\njsonResponse([\n    'id' => $table['id'],\n    'table_number' => $table['table_number'],\n    'status' => $table['status'],\n    'restaurant_id' => $table['restaurant_id']\n]);\n","path":null,"size_bytes":865,"size_tokens":null},"api/order/split.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$input = getInput();\n\n$orderId = (int)($input['order_id'] ?? 0);\n$members = (int)($input['members'] ?? 1);\n\nif ($orderId <= 0) {\n    jsonResponse(['error' => 'Invalid order ID'], 400);\n}\n\nif ($members < 1) {\n    $members = 1;\n}\n\n$db = getDB();\n\n$orderStmt = $db->prepare(\"SELECT total_amount FROM orders WHERE id = ?\");\n$orderStmt->execute([$orderId]);\n$order = $orderStmt->fetch();\n\nif (!$order) {\n    jsonResponse(['error' => 'Order not found'], 404);\n}\n\n$perPerson = ceil($order['total_amount'] / $members);\n\n$existingStmt = $db->prepare(\"SELECT id FROM bill_splits WHERE order_id = ?\");\n$existingStmt->execute([$orderId]);\n$existing = $existingStmt->fetch();\n\nif ($existing) {\n    $updateStmt = $db->prepare(\"UPDATE bill_splits SET member_count = ?, per_person_amount = ? WHERE order_id = ?\");\n    $updateStmt->execute([$members, $perPerson, $orderId]);\n} else {\n    $insertStmt = $db->prepare(\"INSERT INTO bill_splits (order_id, member_count, per_person_amount) VALUES (?, ?, ?)\");\n    $insertStmt->execute([$orderId, $members, $perPerson]);\n}\n\njsonResponse([\n    'success' => true,\n    'order_id' => $orderId,\n    'total' => (int)$order['total_amount'],\n    'members' => $members,\n    'per_person' => $perPerson\n]);\n","path":null,"size_bytes":1332,"size_tokens":null},"api/index.php":{"content":"<?php\nrequire_once __DIR__ . '/includes/utils.php';\ncors();\n\n$uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);\n$method = $_SERVER['REQUEST_METHOD'];\n\n$uri = preg_replace('#^/api#', '', $uri);\n$uri = rtrim($uri, '/');\n\n$routes = [\n    'GET' => [\n        '/restaurant/config' => 'restaurant/config.php',\n        '/table/{id}' => 'restaurant/table.php',\n        '/menu/categories' => 'menu/categories.php',\n        '/menu/items' => 'menu/items.php',\n        '/menu/item/{id}' => 'menu/item.php',\n        '/order/{id}' => 'order/get.php',\n        '/game/reward' => 'game/reward.php',\n    ],\n    'POST' => [\n        '/order/create' => 'order/create.php',\n        '/order/status' => 'order/status.php',\n        '/order/split' => 'order/split.php',\n        '/review/submit' => 'review/submit.php',\n    ]\n];\n\nfunction matchRoute($uri, $pattern) {\n    $pattern = preg_replace('#\\{(\\w+)\\}#', '(?P<$1>[^/]+)', $pattern);\n    $pattern = '#^' . $pattern . '$#';\n    if (preg_match($pattern, $uri, $matches)) {\n        return array_filter($matches, 'is_string', ARRAY_FILTER_USE_KEY);\n    }\n    return false;\n}\n\nif (isset($routes[$method])) {\n    foreach ($routes[$method] as $pattern => $file) {\n        $params = matchRoute($uri, $pattern);\n        if ($params !== false) {\n            $_GET = array_merge($_GET, $params);\n            require __DIR__ . '/' . $file;\n            exit;\n        }\n    }\n}\n\nif ($uri === '' || $uri === '/') {\n    jsonResponse([\n        'api' => 'Restaurant Backend API',\n        'version' => '1.0.0',\n        'endpoints' => [\n            'GET /api/restaurant/config',\n            'GET /api/table/{tableNumber}',\n            'GET /api/menu/categories',\n            'GET /api/menu/items',\n            'GET /api/menu/item/{id}',\n            'POST /api/order/create',\n            'GET /api/order/{orderId}',\n            'POST /api/order/status',\n            'POST /api/order/split',\n            'GET /api/game/reward',\n            'POST /api/review/submit'\n        ]\n    ]);\n}\n\njsonResponse(['error' => 'Not Found', 'uri' => $uri], 404);\n","path":null,"size_bytes":2058,"size_tokens":null},"api/order/status.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$input = getInput();\n\n$orderId = (int)($input['order_id'] ?? 0);\n$newStatus = sanitize($input['status'] ?? '');\n\n$validStatuses = ['received', 'cooking', 'plating', 'delivered'];\n\nif ($orderId <= 0) {\n    jsonResponse(['error' => 'Invalid order ID'], 400);\n}\n\nif (!in_array($newStatus, $validStatuses)) {\n    jsonResponse(['error' => 'Invalid status'], 400);\n}\n\n$db = getDB();\n\n$orderStmt = $db->prepare(\"SELECT * FROM orders WHERE id = ?\");\n$orderStmt->execute([$orderId]);\n$order = $orderStmt->fetch();\n\nif (!$order) {\n    jsonResponse(['error' => 'Order not found'], 404);\n}\n\n$updateStmt = $db->prepare(\"UPDATE orders SET status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?\");\n$updateStmt->execute([$newStatus, $orderId]);\n\nif ($newStatus === 'delivered') {\n    $tableStmt = $db->prepare(\"UPDATE restaurant_tables SET status = 'free' WHERE id = ?\");\n    $tableStmt->execute([$order['table_id']]);\n}\n\njsonResponse([\n    'success' => true,\n    'order_id' => $orderId,\n    'status' => $newStatus\n]);\n","path":null,"size_bytes":1114,"size_tokens":null},"api/menu/categories.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$lang = getLang();\n$restaurantId = getRestaurantId();\n\n$db = getDB();\n$stmt = $db->prepare(\"SELECT * FROM categories WHERE restaurant_id = ? ORDER BY sort_order ASC\");\n$stmt->execute([$restaurantId]);\n$categories = $stmt->fetchAll();\n\n$result = [];\nforeach ($categories as $cat) {\n    $result[] = [\n        'id' => $cat['id'],\n        'name' => [\n            'en' => $cat['name_en'],\n            'bn' => $cat['name_bn']\n        ],\n        'icon' => $cat['icon']\n    ];\n}\n\njsonResponse(['categories' => $result]);\n","path":null,"size_bytes":623,"size_tokens":null},"api/includes/db.php":{"content":"<?php\nrequire_once __DIR__ . '/config.php';\n\nfunction getDB() {\n    static $pdo = null;\n    if ($pdo === null) {\n        try {\n            $dsn = \"pgsql:host=\" . DB_HOST . \";port=\" . DB_PORT . \";dbname=\" . DB_NAME;\n            $pdo = new PDO($dsn, DB_USER, DB_PASS, [\n                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n                PDO::ATTR_EMULATE_PREPARES => false\n            ]);\n        } catch (PDOException $e) {\n            jsonResponse(['error' => 'Database connection failed'], 500);\n            exit;\n        }\n    }\n    return $pdo;\n}\n","path":null,"size_bytes":626,"size_tokens":null},"api/includes/utils.php":{"content":"<?php\nfunction cors() {\n    if (isset($_SERVER['HTTP_ORIGIN'])) {\n        header(\"Access-Control-Allow-Origin: {$_SERVER['HTTP_ORIGIN']}\");\n        header('Access-Control-Allow-Credentials: true');\n    }\n    header('Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS');\n    header('Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With');\n    header('Content-Type: application/json; charset=utf-8');\n    \n    if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {\n        http_response_code(200);\n        exit;\n    }\n}\n\nfunction jsonResponse($data, $code = 200) {\n    http_response_code($code);\n    echo json_encode($data, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);\n    exit;\n}\n\nfunction getInput() {\n    $json = file_get_contents('php://input');\n    return json_decode($json, true) ?? [];\n}\n\nfunction sanitize($value) {\n    if (is_string($value)) {\n        return htmlspecialchars(trim($value), ENT_QUOTES, 'UTF-8');\n    }\n    return $value;\n}\n\nfunction getLang() {\n    return $_GET['lang'] ?? DEFAULT_LANGUAGE;\n}\n\nfunction getRestaurantId() {\n    return (int)($_GET['restaurant_id'] ?? DEFAULT_RESTAURANT_ID);\n}\n\nfunction localizedField($row, $field, $lang = null) {\n    $lang = $lang ?? getLang();\n    $localField = $field . '_' . $lang;\n    $fallback = $field . '_en';\n    return $row[$localField] ?? $row[$fallback] ?? '';\n}\n","path":null,"size_bytes":1358,"size_tokens":null},"router.php":{"content":"<?php\n$uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);\n\nif (preg_match('#^/api#', $uri)) {\n    require __DIR__ . '/api/index.php';\n    exit;\n}\n\n$file = __DIR__ . $uri;\n\nif ($uri !== '/' && is_file($file)) {\n    $ext = pathinfo($file, PATHINFO_EXTENSION);\n    $mimeTypes = [\n        'html' => 'text/html',\n        'css' => 'text/css',\n        'js' => 'application/javascript',\n        'json' => 'application/json',\n        'png' => 'image/png',\n        'jpg' => 'image/jpeg',\n        'jpeg' => 'image/jpeg',\n        'gif' => 'image/gif',\n        'svg' => 'image/svg+xml',\n        'ico' => 'image/x-icon',\n        'woff' => 'font/woff',\n        'woff2' => 'font/woff2',\n        'ttf' => 'font/ttf'\n    ];\n    \n    if (isset($mimeTypes[$ext])) {\n        header('Content-Type: ' . $mimeTypes[$ext]);\n    }\n    \n    header('Cache-Control: no-cache, no-store, must-revalidate');\n    header('Pragma: no-cache');\n    header('Expires: 0');\n    \n    readfile($file);\n    exit;\n}\n\nheader('Cache-Control: no-cache, no-store, must-revalidate');\nheader('Pragma: no-cache');\nheader('Expires: 0');\n\nrequire __DIR__ . '/index.html';\n","path":null,"size_bytes":1124,"size_tokens":null},"api/order/create.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$input = getInput();\n\n$tableNumber = (int)($input['table'] ?? 0);\n$items = $input['items'] ?? [];\n$paymentMethod = sanitize($input['payment_method'] ?? 'cash');\n\nif ($tableNumber <= 0) {\n    jsonResponse(['error' => 'Invalid table number'], 400);\n}\n\nif (empty($items)) {\n    jsonResponse(['error' => 'No items in order'], 400);\n}\n\n$db = getDB();\n$restaurantId = getRestaurantId();\n\n$tableStmt = $db->prepare(\"SELECT id FROM restaurant_tables WHERE table_number = ? AND restaurant_id = ?\");\n$tableStmt->execute([$tableNumber, $restaurantId]);\n$table = $tableStmt->fetch();\n\nif (!$table) {\n    $tableStmt = $db->prepare(\"INSERT INTO restaurant_tables (restaurant_id, table_number, status) VALUES (?, ?, 'busy') RETURNING id\");\n    $tableStmt->execute([$restaurantId, $tableNumber]);\n    $table = $tableStmt->fetch();\n} else {\n    $updateStmt = $db->prepare(\"UPDATE restaurant_tables SET status = 'busy' WHERE id = ?\");\n    $updateStmt->execute([$table['id']]);\n}\n\n$totalAmount = 0;\n$orderItems = [];\n\nforeach ($items as $item) {\n    $itemId = (int)($item['id'] ?? 0);\n    $qty = (int)($item['qty'] ?? 1);\n    \n    if ($itemId <= 0 || $qty <= 0) continue;\n    \n    $itemStmt = $db->prepare(\"SELECT id, price, name_en FROM menu_items WHERE id = ? AND is_available = true\");\n    $itemStmt->execute([$itemId]);\n    $menuItem = $itemStmt->fetch();\n    \n    if ($menuItem) {\n        $orderItems[] = [\n            'menu_item_id' => $menuItem['id'],\n            'quantity' => $qty,\n            'unit_price' => $menuItem['price'],\n            'name' => $menuItem['name_en']\n        ];\n        $totalAmount += $menuItem['price'] * $qty;\n    }\n}\n\nif (empty($orderItems)) {\n    jsonResponse(['error' => 'No valid items found'], 400);\n}\n\n$vat = round($totalAmount * 0.05);\n$service = round($totalAmount * 0.05);\n$grandTotal = $totalAmount + $vat + $service;\n\n$orderStmt = $db->prepare(\"\n    INSERT INTO orders (restaurant_id, table_id, table_number, status, total_amount, payment_method) \n    VALUES (?, ?, ?, 'received', ?, ?) RETURNING id, created_at\n\");\n$orderStmt->execute([$restaurantId, $table['id'], $tableNumber, $grandTotal, $paymentMethod]);\n$order = $orderStmt->fetch();\n\nforeach ($orderItems as $oi) {\n    $oiStmt = $db->prepare(\"INSERT INTO order_items (order_id, menu_item_id, quantity, unit_price) VALUES (?, ?, ?, ?)\");\n    $oiStmt->execute([$order['id'], $oi['menu_item_id'], $oi['quantity'], $oi['unit_price']]);\n}\n\njsonResponse([\n    'success' => true,\n    'order_id' => $order['id'],\n    'table_number' => $tableNumber,\n    'status' => 'received',\n    'subtotal' => $totalAmount,\n    'vat' => $vat,\n    'service' => $service,\n    'total' => $grandTotal,\n    'payment_method' => $paymentMethod,\n    'items' => $orderItems,\n    'created_at' => $order['created_at'],\n    'eta_minutes' => 12\n]);\n","path":null,"size_bytes":2907,"size_tokens":null},"api/restaurant/config.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$lang = getLang();\n$restaurantId = getRestaurantId();\n\n$db = getDB();\n$stmt = $db->prepare(\"SELECT * FROM restaurants WHERE id = ? AND is_active = true\");\n$stmt->execute([$restaurantId]);\n$restaurant = $stmt->fetch();\n\nif (!$restaurant) {\n    jsonResponse(['error' => 'Restaurant not found'], 404);\n}\n\njsonResponse([\n    'id' => $restaurant['id'],\n    'name' => [\n        'en' => $restaurant['name_en'],\n        'bn' => $restaurant['name_bn']\n    ],\n    'tagline' => [\n        'en' => $restaurant['tagline_en'],\n        'bn' => $restaurant['tagline_bn']\n    ],\n    'branding' => json_decode($restaurant['branding_config'] ?? '{}', true)\n]);\n","path":null,"size_bytes":751,"size_tokens":null},"api/menu/items.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$lang = getLang();\n$restaurantId = getRestaurantId();\n$category = $_GET['category'] ?? null;\n$mood = $_GET['mood'] ?? null;\n$trending = isset($_GET['trending']);\n\n$db = getDB();\n\n$sql = \"SELECT * FROM menu_items WHERE restaurant_id = ? AND is_available = true\";\n$params = [$restaurantId];\n\nif ($category) {\n    $sql .= \" AND category_id = ?\";\n    $params[] = $category;\n}\n\nif ($trending) {\n    $sql .= \" AND is_trending = true\";\n}\n\n$sql .= \" ORDER BY is_trending DESC, likes DESC\";\n\n$stmt = $db->prepare($sql);\n$stmt->execute($params);\n$items = $stmt->fetchAll();\n\nif ($mood) {\n    $items = array_filter($items, function($item) use ($mood) {\n        $moods = json_decode($item['mood'] ?? '[]', true);\n        return in_array($mood, $moods);\n    });\n    $items = array_values($items);\n}\n\n$result = [];\nforeach ($items as $item) {\n    $result[] = [\n        'id' => $item['id'],\n        'name' => [\n            'en' => $item['name_en'],\n            'bn' => $item['name_bn']\n        ],\n        'description' => [\n            'en' => $item['description_en'],\n            'bn' => $item['description_bn']\n        ],\n        'price' => (int)$item['price'],\n        'category' => $item['category_id'],\n        'image' => $item['image_url'],\n        'weight' => $item['weight'],\n        'rating' => (float)$item['rating'],\n        'likes' => (int)$item['likes'],\n        'comments' => (int)$item['comments_count'],\n        'tags' => json_decode($item['tags'] ?? '[]', true),\n        'mood' => json_decode($item['mood'] ?? '[]', true),\n        'taste' => json_decode($item['taste'] ?? '[]', true),\n        'trending' => (bool)$item['is_trending'],\n        'allergens' => $item['allergens']\n    ];\n}\n\njsonResponse(['items' => $result]);\n","path":null,"size_bytes":1835,"size_tokens":null},"js/api.js":{"content":"const API_BASE = '/api';\n\nclass ApiService {\n    constructor() {\n        this.cache = {};\n    }\n\n    async fetch(endpoint, options = {}) {\n        const url = `${API_BASE}${endpoint}`;\n        try {\n            const response = await fetch(url, {\n                headers: {\n                    'Content-Type': 'application/json',\n                    ...options.headers\n                },\n                ...options\n            });\n            \n            if (!response.ok) {\n                throw new Error(`API Error: ${response.status}`);\n            }\n            \n            return await response.json();\n        } catch (error) {\n            console.error(`API request failed: ${endpoint}`, error);\n            throw error;\n        }\n    }\n\n    async getRestaurantConfig() {\n        if (this.cache.config) return this.cache.config;\n        const data = await this.fetch('/restaurant/config');\n        this.cache.config = data;\n        return data;\n    }\n\n    async getCategories(lang = 'en') {\n        const data = await this.fetch(`/menu/categories?lang=${lang}`);\n        return data.categories;\n    }\n\n    async getMenuItems(lang = 'en') {\n        const data = await this.fetch(`/menu/items?lang=${lang}`);\n        return data.items;\n    }\n\n    async getMenuItem(id, lang = 'en') {\n        const data = await this.fetch(`/menu/item/${id}?lang=${lang}`);\n        return data;\n    }\n\n    async createOrder(tableNumber, items, paymentMethod) {\n        const data = await this.fetch('/order/create', {\n            method: 'POST',\n            body: JSON.stringify({\n                table: tableNumber,\n                items: items.map(ci => ({ id: ci.item.id, qty: ci.quantity })),\n                payment_method: paymentMethod\n            })\n        });\n        return data;\n    }\n\n    async getOrder(orderId) {\n        const data = await this.fetch(`/order/${orderId}`);\n        return data;\n    }\n\n    async updateOrderStatus(orderId, status) {\n        const data = await this.fetch('/order/status', {\n            method: 'POST',\n            body: JSON.stringify({ order_id: orderId, status })\n        });\n        return data;\n    }\n\n    async splitBill(orderId, members) {\n        const data = await this.fetch('/order/split', {\n            method: 'POST',\n            body: JSON.stringify({ order_id: orderId, members })\n        });\n        return data;\n    }\n\n    async getReward() {\n        const data = await this.fetch('/game/reward');\n        return data;\n    }\n\n    async submitReview(orderId, itemId, rating, comment) {\n        const data = await this.fetch('/review/submit', {\n            method: 'POST',\n            body: JSON.stringify({\n                order_id: orderId,\n                menu_item_id: itemId,\n                rating,\n                comment\n            })\n        });\n        return data;\n    }\n}\n\nconst api = new ApiService();\nexport default api;\n","path":null,"size_bytes":2886,"size_tokens":null},"api/includes/config.php":{"content":"<?php\n$database_url = getenv('DATABASE_URL');\n$parsed = parse_url($database_url);\n\ndefine('DB_HOST', $parsed['host'] ?? 'localhost');\ndefine('DB_PORT', $parsed['port'] ?? 5432);\ndefine('DB_NAME', ltrim($parsed['path'] ?? '', '/'));\ndefine('DB_USER', $parsed['user'] ?? '');\ndefine('DB_PASS', $parsed['pass'] ?? '');\n\ndefine('DEFAULT_RESTAURANT_ID', 1);\ndefine('DEFAULT_LANGUAGE', 'en');\n","path":null,"size_bytes":387,"size_tokens":null},"api/order/get.php":{"content":"<?php\nrequire_once __DIR__ . '/../includes/db.php';\nrequire_once __DIR__ . '/../includes/utils.php';\n\ncors();\n$orderId = (int)($_GET['id'] ?? 0);\n\nif ($orderId <= 0) {\n    jsonResponse(['error' => 'Invalid order ID'], 400);\n}\n\n$db = getDB();\n\n$orderStmt = $db->prepare(\"SELECT * FROM orders WHERE id = ?\");\n$orderStmt->execute([$orderId]);\n$order = $orderStmt->fetch();\n\nif (!$order) {\n    jsonResponse(['error' => 'Order not found'], 404);\n}\n\n$itemsStmt = $db->prepare(\"\n    SELECT oi.*, mi.name_en, mi.name_bn, mi.image_url \n    FROM order_items oi \n    JOIN menu_items mi ON oi.menu_item_id = mi.id \n    WHERE oi.order_id = ?\n\");\n$itemsStmt->execute([$orderId]);\n$items = $itemsStmt->fetchAll();\n\n$splitStmt = $db->prepare(\"SELECT * FROM bill_splits WHERE order_id = ? ORDER BY created_at DESC LIMIT 1\");\n$splitStmt->execute([$orderId]);\n$split = $splitStmt->fetch();\n\n$orderItems = [];\nforeach ($items as $item) {\n    $orderItems[] = [\n        'id' => $item['menu_item_id'],\n        'name' => [\n            'en' => $item['name_en'],\n            'bn' => $item['name_bn']\n        ],\n        'image' => $item['image_url'],\n        'quantity' => (int)$item['quantity'],\n        'unit_price' => (int)$item['unit_price'],\n        'subtotal' => (int)$item['quantity'] * (int)$item['unit_price']\n    ];\n}\n\n$statusTimeline = [\n    'received' => ['completed' => true, 'current' => false],\n    'cooking' => ['completed' => false, 'current' => false],\n    'plating' => ['completed' => false, 'current' => false],\n    'delivered' => ['completed' => false, 'current' => false]\n];\n\n$statusOrder = ['received', 'cooking', 'plating', 'delivered'];\n$currentIndex = array_search($order['status'], $statusOrder);\n\nforeach ($statusOrder as $i => $status) {\n    if ($i < $currentIndex) {\n        $statusTimeline[$status] = ['completed' => true, 'current' => false];\n    } elseif ($i === $currentIndex) {\n        $statusTimeline[$status] = ['completed' => false, 'current' => true];\n    }\n}\n\n$response = [\n    'id' => $order['id'],\n    'table_number' => $order['table_number'],\n    'status' => $order['status'],\n    'total' => (int)$order['total_amount'],\n    'payment_method' => $order['payment_method'],\n    'items' => $orderItems,\n    'timeline' => $statusTimeline,\n    'created_at' => $order['created_at'],\n    'eta_minutes' => 12\n];\n\nif ($split) {\n    $response['split'] = [\n        'member_count' => (int)$split['member_count'],\n        'per_person' => (int)$split['per_person_amount']\n    ];\n}\n\njsonResponse($response);\n","path":null,"size_bytes":2508,"size_tokens":null}},"version":2}